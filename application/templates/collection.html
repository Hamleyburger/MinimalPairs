{% from 'macros.html' import help_container, word_card with context %}
{% extends "layout.html" %}

{% block title %}
{{ title_collection }}
{% endblock %}

{% block submeta %}
<!-- page specific tags for collction -->
<meta name="description" content="{{ collection_meta.description }}" />

<!-- page specific open graph -->
<meta property="og:description" content="{{ collection_meta.og_description }}" />
<meta property="og:image" content="{{ url_for('static', filename=collection_meta.og_image, _external=True ) }}">
<meta property=" og:image:secure_url"
    content="{{ url_for('static', filename=collection_meta.og_image, _external=True ) }}">
<meta property="og:title" content="{{ collection_meta.og_title }}" />
<meta property="og:url" content="{{ url_for('user_blueprint.collection', locale=session.locale, _external=True) }}" />
<link rel="canonical" href="{{ url_for('user_blueprint.collection', locale=session.locale, _external=True) }}" />
<meta property="og:image:alt" content="{{ collection_meta.og_image_alt }}" />

<meta property="og:image:type" content="{{ layout.og_image_type }}" />
<meta property="og:image:width" content="{{ layout.og_image_width }}" />
<meta property="og:image:height" content="{{ layout.og_image_height }}" />
{% endblock %}

{% block main %}
<div class="modal fade" id="croppermodal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content my-cropper-modal">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                <div id="preview" style="width: 100px; height: 100px; overflow: hidden;"></div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">

                <!-- Wrap the image or canvas element with a block element (container) -->
                <div class="container cropper_styles">
                    <div>
                        <img id="cropperimage" src="">
                    </div>
                </div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="cropper-confirm">Save</button>
            </div>
        </div>
    </div>
</div>


{% if collection|length %}
<div class="container-fluid text-center pdfgenerator">
    <div class="row">

        <button id="search-collapse-btn" type="button" class="btn shadow" data-toggle="collapse"
            data-target="#pdf-form-collapsable" aria-expanded="true" aria-controls="collapseOne">{{ btn_PDFtool }} <i
                id="rotate-icon" class="fas fa-angle-down"></i>
        </button>
        <script>
            var url_for_clear = "{{ url_for('user_blueprint.ajax_clear') }}";
        </script>
        <button type="button" class="btn shadow" onclick="clear_collection(url_for_clear, event)" data-toggle="tooltip"
            data-placement="top" title="{{ tooltip_clearall }}"><i class="fas fa-trash-alt"></i> {{ btn_clearall
            }}</button>
    </div>

    <div class="collapse" id="pdf-form-collapsable">
        <form method="POST" action="{{ url_for('user_blueprint.collection', locale=session.locale) }}">

            {{ form.hidden_tag() }}


            <div class="container-fluid background-choices">

                <fieldset class="shadow container">

                    <div class="row">
                        {{ help_container("pdf-", help_pdf_title, help_pdf_cue, help_pdf_content) }}
                    </div>
                    <div class="row">
                        {% for subfield in form.background %}
                        <div class="col">
                            <div class="bg-btn-wrap" style="background-image:
                            url(/static/permaimages/thumbnails/thumb_{{subfield.data}}.png);">
                                <div class="text-background"></div>
                                {{ subfield(class="btn-check") }}
                                {{ subfield.label(class="bgexample shadow btn font-weight-bold") }}
                            </div>
                        </div>
                        {% endfor %}

                    </div>

                    <div class="row">
                        <div class="col-12">
                            <button type="submit" class="pdfbtn shadow"><i class="pdfbtn fas fa-file-pdf"
                                    formaction="{{ url_for('user_blueprint.collection', locale=session.locale) }}"></i>
                                {{ btn_makePDF }} </button>
                        </div>
                    </div>

                </fieldset>

        </form>
    </div>


</div>
</div>



<div class="container contentbox">
    <!-- For loop "pairs" for iterating over pairs -->
    <div class="row">
        {% for word in collection %}
        <div class="col-12 col-md-4 col-sm-6 wordcols" id="wordcol{{word.id}}">
            {% if "default." in word.image.name %}
            {{ word_card(word, uploadbutton=true) }}
            {% else %}
            {{ word_card(word) }}
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}

    <div class="sorry">
        <p>
            {{ collection_tip | safe }}
        </p>
    </div>
</div>
</div>

{% endif %}

{% endblock %}

{% block script %}

<script>
    $("#search-collapse-btn").click(function () {
        //$("#search-collapsable").collapse('toggle'); // This is done with aria stuff in the html
        $("#rotate-icon").toggleClass("fa-rotate-180");
    });
</script>
<script type="text/javascript" src="{{ url_for('static', filename='cropper_scripts.js') }}"></script>

{% endblock script %}